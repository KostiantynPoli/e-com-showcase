import{x as E,y as w,z as m,A as x,d as V,I as F,D as H,k as P,J as U,a as z,K as W,L as A,M as I,N as G,G as J,O as B,P as Q,Q as X,r as Y,s as R,R as Z,S as k,T as K,U as h,V as ee,W as te,X as ae,Y as se,B as ne,Z as re,$ as oe,a0 as ie,a1 as ce,a2 as le,a3 as ue}from"./dwuy3N9H.js";const de={class:"py-16 text-center"},fe={class:"text-3xl md:text-4xl font-bold mb-4"},_e={class:"text-gray-600 text-lg"},me={__name:"Header",props:{title:{type:String,default:"Актуальні промокоди та знижки"},subtitle:{type:String,default:"Оновлені пропозиції від перевірених брендів"}},setup(e){return(t,i)=>(w(),E("section",de,[m("h1",fe,x(e.title),1),m("p",_e,x(e.subtitle),1)]))}},ye={class:"bg-stone-50 border rounded-xl p-4 flex flex-col bg-white hover:shadow-lg transition"},be=["src","alt"],he={class:"font-semibold text-lg mb-2"},ge={class:"text-sm text-gray-600 mb-4 line-clamp-3"},ve={key:0,class:"mb-3 text-sm bg-gray-100 rounded px-3 py-2"},De={class:"font-mono font-semibold"},pe={class:"mt-auto"},Ce={class:"text-xs text-gray-400 mb-3"},xe={class:"text-xs text-gray-400 mb-3"},we=["href"],Ee=V({__name:"OfferCard",props:{offer:{}},setup(e){const t=i=>new Date(i).toLocaleDateString("uk-UA");return(i,r)=>(w(),E("article",ye,[m("img",{src:e.offer.logo_url,alt:e.offer.offer_name,class:"h-12 object-contain mb-4"},null,8,be),m("h2",he,x(e.offer.name),1),m("p",ge,x(e.offer.description),1),e.offer.promocode?(w(),E("div",ve,[r[0]||(r[0]=H(" Промокод: ",-1)),m("span",De,x(e.offer.promocode),1)])):F("",!0),m("div",pe,[m("div",Ce," Дата початку "+x(t(e.offer.date_to)),1),m("div",xe," Дата закінчення "+x(t(e.offer.date_to)),1),m("a",{href:e.offer.url,target:"_blank",class:"block text-center bg-black text-white py-2 rounded-lg hover:bg-gray-800"}," Перейти до оффера ",8,we)])]))}}),Pe=Object.assign(Ee,{__name:"OfferCard"}),Oe={trailing:!0};function Se(e,t=25,i={}){if(i={...Oe,...i},!Number.isFinite(t))throw new TypeError("Expected `wait` to be a finite number");let r,s,f=[],n,a;const v=(l,y)=>(n=$e(e,l,y),n.finally(()=>{if(n=null,i.trailing&&a&&!s){const b=v(l,a);return a=null,b}}),n),D=function(...l){return i.trailing&&(a=l),n||new Promise(y=>{const b=!s&&i.leading;clearTimeout(s),s=setTimeout(()=>{s=null;const c=i.leading?r:v(this,l);a=null;for(const _ of f)_(c);f=[]},t),b?(r=v(this,l),y(r)):f.push(y)})},o=l=>{l&&(clearTimeout(l),s=null)};return D.isPending=()=>!!s,D.cancel=()=>{o(s),f=[],a=null},D.flush=()=>{if(o(s),!a||n)return;const l=a;return a=null,v(this,l)},D}async function $e(e,t,i){return await e.apply(t,i)}const Me=Symbol.for("nuxt:client-only");function Ne(...e){const t=typeof e[e.length-1]=="string"?e.pop():void 0;Be(e[0],e[1])&&e.unshift(t);let[i,r,s={}]=e,f=!1;const n=P(()=>U(i));if(typeof n.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof r!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const a=z();s.server??=!0,s.default??=Te,s.getCachedData??=j,s.lazy??=!1,s.immediate??=!0,s.deep??=W.deep,s.dedupe??="cancel",s._functionName,a._asyncData[n.value];function v(){const c={cause:"initial",dedupe:s.dedupe};return a._asyncData[n.value]?._init||(c.cachedData=s.getCachedData(n.value,a,{cause:"initial"}),a._asyncData[n.value]=T(a,n.value,r,s,c.cachedData)),()=>a._asyncData[n.value].execute(c)}const D=v(),o=a._asyncData[n.value];o._deps++;const l=s.server!==!1&&a.payload.serverRendered;{let c=function(d){const u=a._asyncData[d];u?._deps&&(u._deps--,u._deps===0&&u?._off())};const _=A();if(_&&l&&s.immediate&&!_.sp&&(_.sp=[]),_&&!_._nuxtOnBeforeMountCbs){_._nuxtOnBeforeMountCbs=[];const d=_._nuxtOnBeforeMountCbs;I(()=>{d.forEach(u=>{u()}),d.splice(0,d.length)}),G(()=>d.splice(0,d.length))}const C=_&&(_._nuxtClientOnly||J(Me,!1));l&&a.isHydrating&&(o.error.value||o.data.value!==void 0)?o.status.value=o.error.value?"error":"success":_&&(!C&&a.payload.serverRendered&&a.isHydrating||s.lazy)&&s.immediate?_._nuxtOnBeforeMountCbs.push(D):s.immediate&&o.status.value!=="success"&&D();const g=X(),p=B(n,(d,u)=>{if((d||u)&&d!==u){f=!0;const M=a._asyncData[u]?.data.value!==void 0,q=a._asyncDataPromises[u]!==void 0,N={cause:"initial",dedupe:s.dedupe};if(!a._asyncData[d]?._init){let S;u&&M?S=a._asyncData[u].data.value:(S=s.getCachedData(d,a,{cause:"initial"}),N.cachedData=S),a._asyncData[d]=T(a,d,r,s,S)}a._asyncData[d]._deps++,u&&c(u),(s.immediate||M||q)&&a._asyncData[d].execute(N),ee(()=>{f=!1})}},{flush:"sync"}),O=s.watch?B(s.watch,()=>{f||a._asyncData[n.value]?._execute({cause:"watch",dedupe:s.dedupe})}):()=>{};g&&Q(()=>{p(),O(),c(n.value)})}const y={data:$(()=>a._asyncData[n.value]?.data),pending:$(()=>a._asyncData[n.value]?.pending),status:$(()=>a._asyncData[n.value]?.status),error:$(()=>a._asyncData[n.value]?.error),refresh:(...c)=>a._asyncData[n.value]?._init?a._asyncData[n.value].execute(...c):v()(),execute:(...c)=>y.refresh(...c),clear:()=>{const c=a._asyncData[n.value];if(c?._abortController)try{c._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{c._abortController=void 0}L(a,n.value)}},b=Promise.resolve(a._asyncDataPromises[n.value]).then(()=>y);return Object.assign(b,y),b}function $(e){return P({get(){return e()?.value},set(t){const i=e();i&&(i.value=t)}})}function Be(e,t){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof t=="function")}function L(e,t){t in e.payload.data&&(e.payload.data[t]=void 0),t in e.payload._errors&&(e.payload._errors[t]=void 0),e._asyncData[t]&&(e._asyncData[t].data.value=h(e._asyncData[t]._default()),e._asyncData[t].error.value=void 0,e._asyncData[t].status.value="idle"),t in e._asyncDataPromises&&(e._asyncDataPromises[t]=void 0)}function Re(e,t){const i={};for(const r of t)i[r]=e[r];return i}function T(e,t,i,r,s){e.payload._errors[t]??=void 0;const f=r.getCachedData!==j,n=i,a=r.deep?Y:R,v=s!==void 0,D=e.hook("app:data:refresh",async l=>{(!l||l.includes(t))&&await o.execute({cause:"refresh:hook"})}),o={data:a(v?s:r.default()),pending:P(()=>o.status.value==="pending"),error:Z(e.payload._errors,t),status:R("idle"),execute:(...l)=>{const[y,b=void 0]=l,c=y&&b===void 0&&typeof y=="object"?y:{};if(e._asyncDataPromises[t]&&(c.dedupe??r.dedupe)==="defer")return e._asyncDataPromises[t];{const g="cachedData"in c?c.cachedData:r.getCachedData(t,e,{cause:c.cause??"refresh:manual"});if(g!==void 0)return e.payload.data[t]=o.data.value=g,o.error.value=void 0,o.status.value="success",Promise.resolve(g)}o._abortController&&o._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),o._abortController=new AbortController,o.status.value="pending";const _=new AbortController,C=new Promise((g,p)=>{try{const O=c.timeout??r.timeout,d=Ve([o._abortController?.signal,c?.signal],_.signal,O);if(d.aborted){const u=d.reason;p(u instanceof Error?u:new DOMException(String(u??"Aborted"),"AbortError"));return}return d.addEventListener("abort",()=>{const u=d.reason;p(u instanceof Error?u:new DOMException(String(u??"Aborted"),"AbortError"))},{once:!0,signal:_.signal}),Promise.resolve(n(e,{signal:d})).then(g,p)}catch(O){p(O)}}).then(async g=>{let p=g;r.transform&&(p=await r.transform(g)),r.pick&&(p=Re(p,r.pick)),e.payload.data[t]=p,o.data.value=p,o.error.value=void 0,o.status.value="success"}).catch(g=>{if(e._asyncDataPromises[t]&&e._asyncDataPromises[t]!==C||o._abortController?.signal.aborted)return e._asyncDataPromises[t];if(typeof DOMException<"u"&&g instanceof DOMException&&g.name==="AbortError")return o.status.value="idle",e._asyncDataPromises[t];o.error.value=K(g),o.data.value=h(r.default()),o.status.value="error"}).finally(()=>{_.abort(),delete e._asyncDataPromises[t]});return e._asyncDataPromises[t]=C,e._asyncDataPromises[t]},_execute:Se((...l)=>o.execute(...l),0,{leading:!0}),_default:r.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{D(),e._asyncData[t]?._init&&(e._asyncData[t]._init=!1),f||k(()=>{e._asyncData[t]?._init||(L(e,t),o.execute=()=>Promise.resolve())})}};return o}const Te=()=>{},j=(e,t,i)=>{if(t.isHydrating)return t.payload.data[e];if(i.cause!=="refresh:manual"&&i.cause!=="refresh:hook")return t.static.data[e]};function Ve(e,t,i){const r=e.filter(n=>!!n);if(typeof i=="number"&&i>=0){const n=AbortSignal.timeout?.(i);n&&r.push(n)}if(AbortSignal.any)return AbortSignal.any(r);const s=new AbortController;for(const n of r)if(n.aborted){const a=n.reason??new DOMException("Aborted","AbortError");try{s.abort(a)}catch{s.abort()}return s.signal}const f=()=>{const a=r.find(v=>v.aborted)?.reason??new DOMException("Aborted","AbortError");try{s.abort(a)}catch{s.abort()}};for(const n of r)n.addEventListener?.("abort",f,{once:!0,signal:t});return s.signal}const Fe={class:"container mx-auto px-4 py-10"},Le={key:0,class:"text-center text-red-600"},je={class:"relative"},qe={class:"absolute inset-0 flex items-center justify-center"},He={class:"flex justify-center items-center gap-4 mt-10"},Ue=["disabled"],ze={class:"font-medium"},We=["disabled"],Ie=V({__name:"index",async setup(e){let t,i;const r=te(),s=ae(),f=P(()=>Number(r.query.page)||1),{data:n,pending:a,error:v}=([t,i]=se(()=>Ne(()=>`offers-page-${f.value}`,()=>$fetch("/api/offers",{query:{page:f.value}}),{watch:[f]})),t=await t,i(),t);function D(y){s.push({query:{...r.query,page:y}})}const o=P(()=>n.value?.data??[]),l=P(()=>n.value?.total_pages??1);return(y,b)=>{const c=me,_=Pe;return w(),E("section",Fe,[ne(c),h(v)?(w(),E("div",Le," Помилка ")):F("",!0),m("div",je,[m("div",{class:oe(["grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 transition-opacity duration-200",{"opacity-50 pointer-events-none":h(a)}])},[(w(!0),E(ie,null,ce(h(o),C=>(w(),ue(_,{key:C.id,offer:C},null,8,["offer"]))),128))],2),re(m("div",qe,[...b[2]||(b[2]=[m("div",{class:"px-4 py-2 bg-white shadow rounded text-gray-600"}," Завантаження... ",-1)])],512),[[le,h(a)]])]),m("div",He,[m("button",{class:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",disabled:h(f)<=1||h(a),onClick:b[0]||(b[0]=C=>D(h(f)-1))}," ← Назад ",8,Ue),m("span",ze,x(h(f))+" / "+x(h(l)),1),m("button",{class:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",disabled:h(f)>=h(l)||h(a),onClick:b[1]||(b[1]=C=>D(h(f)+1))}," Вперед → ",8,We)])])}}});export{Ie as default};
